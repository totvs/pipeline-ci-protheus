# This is a basic workflow to help you get started with Actions

name: CI

# Controls when the workflow will run
on:
  # Triggers the workflow on push or pull request events but only for the "main" branch
  push:
    branches: [ "main" ]

  # Allows you to run this workflow manually from the Actions tab
  workflow_dispatch:

# A workflow run is made up of one or more jobs that can run sequentially or in parallel
jobs:
  analysis:
      runs-on: self-hosted
      # container:
      #   image: totvsengpro/advpl-tlpp-code-analyzer
      #   env:
      #     TESTE_ENV: env_existe
      #   # volumes:
      #     # - ${{ github.workspace }}/src:/tmp
      #     # - ${{ github.workspace }}/analyser/config.json:/bin/conf/config.json
      #     # - ./analyser/output:/bin/output
      #   options: --user root
      steps:
        - name: Checkout repository
          uses: actions/checkout@v3
        - name: pwd
          run: pwd
        - name: list
          run: ls -lah
        - name: check_env
          run: echo $TESTE_ENV
        - name: docker
          run: | 
            docker run --rm \
            -v ${{ github.workspace }}/src:/tmp \
            -v ${{ github.workspace }}/analyser/config.json:/bin/conf/config.json \
            -v ${{ github.workspace }}/analyser/output:/bin/output \
            totvsengpro/advpl-tlpp-code-analyzer
        
